<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Colorlib Templates">
    <meta name="author" content="Colorlib">
    <meta name="keywords" content="Colorlib Templates">

    <!-- Title Page-->
    <b><title th:text="${operationTitle} + ' expense'">New expense</title></b>

    <!-- Icons font CSS-->
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/datepicker/daterangepicker.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link rel="stylesheet" th:href="@{/css/main.css}" media="all">
</head>

<body>
<div class="page-wrapper bg-gra-03 p-t-45 p-b-50">
    <div class="wrapper wrapper--w790">
        <div class="card card-5">
            <div class="card-heading">
                <h2 class="title">New Expense Form</h2>
            </div>
            <div class="card-body">
                <form action="#" th:action="@{/expense/save}" th:object="${newExpense}" method="post">
                    <input type="hidden" th:field="*{id}"/>
                    <div class="form-row m-b-55">
                        <div class="name">Name</div>
                        <div class="value">
                            <div class="row row-space">
                                <div class="col-2">
                                    <div class="input-group-desc">
                                        <input class="input--style-5" type="text" th:field="*{expenseTitle}" name="name">
                                        <label class="label--desc">expense name</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="name">Amount</div>
                        <div class="value">
                            <div class="input-group">
                                <input class="input--style-5" type="text" th:field="*{expenseAmount}" name="amount">
                                <label class="label--desc">amount</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="name">Payment Method</div>
                        <div class="value">
                            <div class="input-group">
                                <div class="rs-select2 js-select-simple select--no-search">
                                    <select id="paymentMethod" th:field="*{paymentMethod}">
                                        <option th:each="method : ${T(pl.mpas.homebudget.domain.PaymentMethod).values()}"
                                                th:value="${method}"
                                                th:text="${method}">
                                        </option>
                                    </select>
                                    <div class="select-dropdown"></div>
                                </div>
                                <label class="label--desc">select option</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="name">Category Type</div>
                        <div class="value">
                            <div class="input-group">
                                <div class="rs-select2 js-select-simple select--no-search">
                                    <select id="categoryType" th:field="*{category.categoryName}">
                                        <option th:each="category : ${categories}"
                                                th:value="${category.categoryName}"
                                                th:text="${category.categoryName}">
                                        </option>
                                    </select>
                                    <div class="select-dropdown"></div>
                                </div>
                                <label class="label--desc">select option</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="name">Date and time:</div>
                        <div class="value">
                            <div>
                                <div id="dateField">
                                    <p> <input type="date" th:text="${#temporals.format(newExpense.expenseDate, 'dd-MM-yyyy HH:mm')}"/></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="name">Location:</div>
                        <div class="value">
                            <div>
<!--                                <div id="locationField">-->
<!--                                    <p class="name"><input id="autocomplete" placeholder="Enter your address" onfocus="geolocate()" type="text"/></p>-->
<!--                                </div>-->
<!--                                <br>-->
<!--                                <br>-->
<!--                                <div id="map"></div>-->
                                <div id="formatted-address"></div>
                                <div id="address-components"></div>
                                <div id="geometry"></div>
                            </div>
                        </div>
                    </div>
                    <br>

                    <div>
                        <button class="btn btn--radius-2 btn--green" href="#" th:href="@{/expense/all}" type="submit" th:align="left">
                            <a>Save</a>
                        </button>
                        <a class="btn btn--radius-2 btn--red" href="#" th:href="@{/home}" role="button" th:align="center">
                            Main page
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

//        function initMap() {
//            var location = {lat: -25.363, lng: 131.044};
//            var map = new google.maps.Map(document.getElementById("map"), {
//                zoom: 4,
//                center: location
//            });
//            var marker = new google.maps.Marker({
//                position: location,
//                map: map
//            })
//            geocode();
//        }
        geocode();


        function geocode() {

            // var location = document.getElementById('location-input').value;

            axios.get('https://maps.googleapis.com/maps/api/geocode/json', {
                params: {
                    address:'Warszawa',
                    key:'AIzaSyDqj4DrPsPYB7n1ucEZZz13bwBBhExRZJ4'
                }
            })
            .then(function (response){
                // Log full response
               console.log(response);

               //Formatted address
               var formattedAddress = response.data.results[0].formatted_address;
               var formattedAddressOutput = `
                    <ul class="list-group">
                        <li class="list-group-item">${formattedAddress}</li>
                    </ul>
               `;

               //Address Components
                var addressComponents = response.data.results[0].address_components;
                var addressComponentsOutput = '<ul class="list-group">';

                for (var i=0; i < addressComponents.length; i++ ){
                    addressComponentsOutput += `
                        <li class="list-group-item"><strong>${addressComponents[i].types[0]}</strong>: ${addressComponents[i].long_name}</li>
                    `;
                }
                addressComponentsOutput += '</ul>';

                //Geometry
                var lat = response.data.results[0].geometry.location.lat;
                var lng = response.data.results[0].geometry.location.lng;
                var geometryOutput = `
                    <ul class="list-group">
                        <li class="list-group-item"><strong>Latitude: </strong>${lat}</li>
                        <li class="list-group-item"><strong>Longitude: </strong>${lng}</li>
                    </ul>
               `;

               //Output to app
                document.getElementById('formatted-address').innerHTML = formattedAddressOutput;
                document.getElementById('address-components').innerHTML = addressComponentsOutput;
                document.getElementById('geometry').innerHTML = geometryOutput;
            })
            .catch(function (error){
               console.log(error);
            });
        }
    //
    //     function geolocate() {
    //     if (navigator.geolocation) {
    //     navigator.geolocation.getCurrentPosition(function(position) {
    //             var geolocation = {
    //             lat: position.coords.latitude,
    //             lng: position.coords.longitude
    //             };
    //             var circle = new google.maps.Circle({
    //             center: geolocation,
    //             radius: position.coords.accuracy
    //             });
    //     autocomplete.setBounds(circle.getBounds());
    //             });
    //         }
    //         initMap();
    //     }
    //     function initAutocomplete() {
    //     autocomplete = new google.maps.places.Autocomplete(
    //         (document.getElementById('autocomplete')),
    //         {types: ['geocode']});
    //
    //     autocomplete.addListener('place_changed', fillInAddress);
    // }
    //     function fillInAddress() {
    //     var place = autocomplete.getPlace();
    // }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqj4DrPsPYB7n1ucEZZz13bwBBhExRZJ4&libraries=geometry,places&callback=initMap"></script>
<!--<script async defer src="https://maps.googleapis.com/maps/api/geocode/json?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA&key=AIzaSyDqj4DrPsPYB7n1ucEZZz13bwBBhExRZJ4&libraries=geometry,places&callback=initMap"></script>-->
</body>
</html>